<% win = 0 %>
<% lose = 0 %>
<% draw = 0 %>
<% probability = 0 %>


<%# if budget.total.to_i > 0 %>
<%# win += 1 %>
<%# elsif budget.total.to_i < 0 %>
<%# lose += 1 %>
<%# elsif budget.total.to_i == 0 %>
<%# draw += 1 %>
<%#end%>

<%#end%>
<%# probability = (win/num.to_f*100).floor(2)  %>

<%# total.each do |year,total| %>
<% Budget.group("YEAR(start_time)").sum(:total).each do |year,total| %>
<div class="main-budget">
  <div class="budget">
    <div class="main-data">
      <p><%= "#{year}年" %></p>

      <% if total.to_i < 0 %>
        <p>収支<span style="color:red"><%= "#{number_to_currency(total, strip_insignificant_zeros: true)}" %></span></p>
      <%else%>
        <p>収支<%= "+#{number_to_currency(total, strip_insignificant_zeros: true)}" %></p>
      <%end%>

    </div>
    <div class="data">
      <div class="toshi-data">
        <div class="win-data">
          <ul>
            <li>回数</li>
            <li>勝率</li>
          </ul>
        </div>
        <div class="price-data">
          <ul>
            <% Budget.group("YEAR(start_time)").count.each do |year,num| %>
            <li><%= "#{num}回" %></li>
            <%end%>
            <li><%= "#{probability}% (#{win}勝#{lose}敗#{draw}分)" %></li>
          </ul>
        </div>
      </div>
      <div class="toshi-data">
        <div class="win-data">
          <ul>
            <li>投資</li>
            <li>回収</li>
          </ul>
        </div>
        <div class="price-data">
          <ul>
            <% Budget.group("YEAR(start_time)").sum(:price).each do |year,price| %>
            <li><%= "#{number_to_currency(price, strip_insignificant_zeros: true)}"  %></li>
            <%end%>
            <% Budget.group("YEAR(start_time)").sum(:recovery).each do |year,recovery| %>
            <li><%= "#{number_to_currency(recovery, strip_insignificant_zeros: true)}" %></li>
            <%end%>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
<%end%>